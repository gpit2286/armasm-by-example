<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="The shop I own (I don't) had a sale but some employee decided to not write down the original 
price of all of the items! Well, it's simple because all of the prices are 1/3 of their 
original amounts. The problem is I have a billion prices so I need to figure out 
how to get the original price as quickly as possible!!! Take the list of prices and 
output the original price. No need to output the discounted price. 

Your input is in the template file. 
">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Program 15: The Un-sale">
<meta property="og:description" content="The shop I own (I don't) had a sale but some employee decided to not write down the original 
price of all of the items! Well, it's simple because all of the prices are 1/3 of their 
original amounts. The problem is I have a billion prices so I need to figure out 
how to get the original price as quickly as possible!!! Take the list of prices and 
output the original price. No need to output the discounted price. 

Your input is in the template file. 
">
<meta property="og:type" content="article">
<meta property="og:url" content="https://armasm.com/docs/bit-operations/unsale/"><meta property="article:section" content="docs">
<title>Program 15: The Un-sale | ARM Assembly By Example</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.cdf1d3339ad599910ecaf0b922791999eccee31382959665fd94442ac92b40e9.js integrity="sha256-zfHTM5rVmZEOyvC5InkZmezO4xOClZZl/ZREKskrQOk=" crossorigin=anonymous></script>
<style>.blink_text{animation:.5s blinker linear infinite;color:red}@keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>ARM Assembly By Example</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Getting to Hello World</span>
<ul>
<li>
<a href=/docs/getting-to-hello-world/basics/>The Basics</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/exiting/>Program 1: Exiting</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/hello-world/>Program 2: Hello World</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Registers and Memory</span>
<ul>
<li>
<a href=/docs/registers-and-memory/register-overview/>Register Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-overview/>Memory Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/find-the-otter/>Program 3: Find the Otter</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-copy/>Program 4: Memory Copy</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Branches and Conditionals</span>
<ul>
<li>
<a href=/docs/branches-and-conditionals/conditionals/>Conditionals</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/branches-and-loops/>Branches and Loops</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/hello-world-revisited/>Program 5: Hello World Revisited</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/sticky-keyboard/>Program 6: Sticky Keyboard</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/inspecting-our-program/>Inspecting Our Program</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/cloning-myself/>Program 7: Cloning Myself</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Arithmetic</span>
<ul>
<li>
<a href=/docs/arithmetic/errors-and-tests/>Errors and Tests</a>
</li>
<li>
<a href=/docs/arithmetic/datatypes/>Datatypes</a>
</li>
<li>
<a href=/docs/arithmetic/multiplication/>Multiplication</a>
</li>
<li>
<a href=/docs/arithmetic/itoa/>Program 8: ITOA</a>
</li>
<li>
<a href=/docs/arithmetic/the-stack/>The Stack</a>
</li>
<li>
<a href=/docs/arithmetic/factorial/>Program 9: Factorials</a>
</li>
<li>
<a href=/docs/arithmetic/sum-of-squares/>Program 10: Sum of Squares</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Bit Operations</span>
<ul>
<li>
<a href=/docs/bit-operations/signed-numbers/>Signed Numbers</a>
</li>
<li>
<a href=/docs/bit-operations/positivty/>Program 11: All Positivity</a>
</li>
<li>
<a href=/docs/bit-operations/exorcise/>Exorcise and bicycle orr...</a>
</li>
<li>
<a href=/docs/bit-operations/ok-be-negative/>Program 12: Ok, Be Negative</a>
</li>
<li>
<a href=/docs/bit-operations/xor-cipher/>Program 13: XOR Cipher</a>
</li>
<li>
<a href=/docs/bit-operations/shifting/>Shifting and Rotating</a>
</li>
<li>
<a href=/docs/bit-operations/hex-and-love/>Program 14: Hex and Love</a>
</li>
<li>
<a href=/docs/bit-operations/unsale/ class=active>Program 15: The Un-sale</a>
</li>
<li>
<a href=/docs/bit-operations/64-bit-math/>Program 16: 64-bit Math</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Working in Linux</span>
<ul>
<li>
<a href=/docs/working-in-linux/add-the-arguments/>Program 17: Add the Arguments</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-inputs/>Program 18: Add the Inputs</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-file/>Program 19: Add the File</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix A: VFP Coprocessor</span>
<ul>
<li>
<a href=/docs/fpu/overview/>FPU Overview</a>
</li>
<li>
<a href=/docs/fpu/here-to-there/>Program 20: Here to There</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix B: NEON Coprocessor</span>
<ul>
<li>
<a href=/docs/neon/overview/>NEON Overview</a>
</li>
<li>
<a href=/docs/neon/bus-rider/>Program 21: Bus Rider</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Program 15: The Un-sale</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#multiply-by-base>Multiply by &lt;base></a></li>
<li><a href=#rsb-operation>RSB operation</a></li>
<li><a href=#note-on-pre-optimization>Note on pre-optimization</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1>
<a href=/docs/bit-operations/unsale/ style=color:#000>Program 15: The Un-sale</a>
</h1>
<h2 id=multiply-by-base>
Multiply by &lt;base>
<a class=anchor href=#multiply-by-base>#</a>
</h2>
<p>In decimal, it&rsquo;s really easy to multiply by 10. You just simply add a 0 to the end of
the number.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>3 * 10 = 30  
30 * 10 = 300 
</code></pre></div><p>Boom. Did you know this works in every base?</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>0x1 (1) * 16 = 0x10 (16)
0x10 (16) * 16 = 0x100 (256) 
</code></pre></div><p>Boom. You can take this knowledge and combine it with left shifts to multiply by 2 easily.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>2 (0b10) * 2 = 0b100 (4) 
4 (0b100) * 2 = 0b1000 (8) 
8 (0b1000) * 2 = 0b10000 (16) 
16 (0b10000) * 2 = 0b100000 (32) 
</code></pre></div><p>And right shifts? Divide by two!</p>
<h2 id=rsb-operation>
RSB operation
<a class=anchor href=#rsb-operation>#</a>
</h2>
<p>Generally the SUB operation is great. You have a number and you want to subtract
another number, works perfect. Sometimes though, it may be beneficial to put the
&ldquo;larger&rdquo; number in the operand2. This would allow you to do things like shifting a
value and then subtracting from that. The ARM processor has such an operation call
RSB or reverse subtraction.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm>    rsb     <span style=color:#cb4b16>r0</span>, <span style=color:#cb4b16>r1</span>, <span style=color:#cb4b16>r2</span>      <span style=color:#93a1a1;font-style:italic>@ subtract r1 from r2 and store in r0 
</span><span style=color:#93a1a1;font-style:italic></span>                            <span style=color:#93a1a1;font-style:italic>@ r2 can be any form of the operand2 
</span></code></pre></div><h2 id=note-on-pre-optimization>
Note on pre-optimization
<a class=anchor href=#note-on-pre-optimization>#</a>
</h2>
<p>One trap I think many programmers fall into (myself included) is to optimize a program
before there is a problem. Sometimes it&rsquo;s only by doing the &ldquo;wrong and slow&rdquo; way that you
realize that it&rsquo;s actually okay. There are also some times where the compiler will
use intermediate steps (e.g., LLVM) and optimize it better than you could.
However, for this problem, I&rsquo;m asking you to pre-optimize on purpose.</p>
<p>It would be very easy to write this:</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm>    mov     <span style=color:#cb4b16>r1</span>, #<span style=color:#2aa198;font-weight:700>3</span>          <span style=color:#93a1a1;font-style:italic>@ this only needs to be done once to mul by reg 
</span><span style=color:#93a1a1;font-style:italic></span>    mov     <span style=color:#cb4b16>r0</span>, #<span style=color:#2aa198;font-weight:700>5</span>          <span style=color:#93a1a1;font-style:italic>@ this would be once per loop 
</span><span style=color:#93a1a1;font-style:italic></span>    mul     <span style=color:#cb4b16>r0</span>, <span style=color:#cb4b16>r0</span>, <span style=color:#cb4b16>r1</span>      <span style=color:#93a1a1;font-style:italic>@ mul r0 * r1 (3) and store in r0 
</span></code></pre></div><p>MUL will take a maximum of 5 processor cycles depending on number size.
While writing small programs this isn&rsquo;t a problem. If you&rsquo;re writing a program
that will process billions or trillions of operations, it can add up. (Think possibly
a transform on a video stream) The ARM processor that is inside the Raspberry Pi
I use for writing these programs has a 900MHz processor. That is only 180,000,000
multiplications a second at its slowest. This is where getting creative can pay off.</p>
<p>There is a way that only takes 1 cycle<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p>
<p>If you wrote this:</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm>    mov     <span style=color:#cb4b16>r1</span>, #<span style=color:#2aa198;font-weight:700>3</span>              <span style=color:#93a1a1;font-style:italic>@ this is once per loop again
</span><span style=color:#93a1a1;font-style:italic></span>    rsb     <span style=color:#cb4b16>r0</span>, <span style=color:#cb4b16>r1</span>, <span style=color:#cb4b16>r1</span> lsl #<span style=color:#2aa198;font-weight:700>2</span>   <span style=color:#93a1a1;font-style:italic>@ essentially 4(r1) - r1 
</span></code></pre></div><p>The reverse subtract, even with the shift, would only take one cycle. This is
because the barrel shifter is outside of the ALU and will do some of the
heavy lifting here. There are some limitations as this wouldn&rsquo;t work with float
numbers (you shouldn&rsquo;t be using float numbers for currency anyway ü§∑‚Äç‚ôÇÔ∏è), the numbers
you use would need to fit inside the first 30 bits so the shift didn&rsquo;t lose data,
etc. Doing this, though, would only take (at best) 1/5th of the time
and 1/2 the time at worst</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>99% sure from the spec. Please correct me if it&rsquo;s not&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
<hr>
<h2>Program 15: The Un-sale Video </h2>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/bzYcJhfBJmo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
<div style=width:100%;display:flex;flex-direction:column>
<div style="flex:1 0;padding-bottom:16px">
<div style="display:flex;flex:1 0 auto;flex-direction:column">
<div style=font-weight:700>Description of Program</div>
<div><p>The shop I own (I don&rsquo;t) had a sale but some employee decided to not write down the original
price of all of the items! Well, it&rsquo;s simple because all of the prices are 1/3 of their
original amounts. The problem is I have a billion prices so I need to figure out
how to get the original price as quickly as possible!!! Take the list of prices and
output the original price. No need to output the discounted price.</p>
<p>Your input is in the template file.</p>
</div>
</div>
</div>
<div style=display:flex;flex-direction:row>
<div style="display:flex;flex:1 0 auto;flex-direction:column">
<div style=font-weight:700>Template/Input</div>
<div>
<a href=https://github.com/gpit2286/armasm-by-example/tree/master/15-unsale/template>Github</a>
</div>
</div>
<div style="display:flex;flex:1 0 auto;flex-direction:column">
<div style=font-weight:700>Completed Code</div>
<div><a href=https://github.com/gpit2286/armasm-by-example/tree/master/15-unsale>Github</a></div>
</div>
<div style="display:flex;flex:2 0 auto;flex-direction:column">
<div style=font-weight:700>Expected Output</div>
<div>
<pre style=margin:0;padding-top:4px;width:auto>2733
2607
1698
2874
2361
</pre>
</div>
</div>
</div>
</div>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#multiply-by-base>Multiply by &lt;base></a></li>
<li><a href=#rsb-operation>RSB operation</a></li>
<li><a href=#note-on-pre-optimization>Note on pre-optimization</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>